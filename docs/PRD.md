# 커피 주문 앱

## 1. 프로젝트 개요

### 1.1 프로젝트명
커피 주문 앱

### 1.2 프로젝트 목적
사용자가 커피 메뉴를 주문하고, 관리자가 주문을 관리할 수 있는 간단한 풀스택 웹 앱

### 1.3 개발 범위
- 주문하기 화면(메뉴 선택 및 장바구니 기능)
- 관리자 화면(재고 관리 및 주문 상태 관리)
- 데이터를 생성/조회/수정/삭제할 수 있는 기능

## 2. 기술 스택
- 프런트엔드 : HTML, CSS, 리액트, 자바스크립트
- 백엔드 : Node.js, Express
- 데이터베이스 : PostgreSQL

## 3. 기본 사항
- 프런트엔드와 백엔드를 따로 개발
- 기본적인 웹 기술만 사용
- 학습 목적이므로 사용자 인증이나 결제 기능은 제외
- 메뉴는 커피 메뉴만 있음

## 4. 프런트엔드 UI 요구사항

### 4.1 주문하기 화면

#### 4.1.1 레이아웃 구조
화면은 상단 헤더, 중앙 메뉴 영역, 하단 장바구니 영역으로 구성됩니다.

**전체 레이아웃:**
- 헤더: 화면 상단 고정
- 메뉴 아이템 섹션: 중앙 영역, 가로로 배치 (3개 이상일 경우 가로 스크롤 또는 그리드 레이아웃)
- 장바구니 섹션: 화면 하단 고정

#### 4.1.2 헤더 섹션

**구성 요소:**
- 좌측: 브랜드명 "COZY" (사각형 박스 형태로 표시)
- 우측: 네비게이션 버튼
  - "주문하기" 버튼 (활성 상태: 어두운 배경 또는 강조 표시)
  - "관리자" 버튼 (비활성 상태: 밝은 회색 테두리)

**스타일:**
- 브랜드명은 사각형 박스 형태로 표시
- 네비게이션 버튼은 밝은 회색 테두리
- 활성 탭("주문하기")은 시각적으로 구분 가능하도록 처리

**기능:**
- "관리자" 버튼 클릭 시 관리자 화면으로 이동

#### 4.1.3 메뉴 아이템 카드

**카드 구조:**
각 메뉴 아이템은 카드 형태로 표시되며, 다음 요소들을 포함합니다:

1. **이미지 영역**
   - 상단에 메뉴 이미지 표시 영역
   - 이미지가 없을 경우 플레이스홀더 처리 (대각선 교차선 표시)
   - 사각형 형태로 일관된 크기 유지

2. **메뉴 정보**
   - 메뉴명 (예: "아메리카노(ICE)", "아메리카노(HOT)", "카페라떼")
   - 가격 (예: "4,000원", "5,000원")
   - 설명 텍스트 ("간단한 설명...")

3. **옵션 선택**
   - 체크박스 형태의 옵션 선택
   - 옵션 예시:
     - "샷 추가 (+500원)" - 선택 시 추가 금액 500원 적용
     - "시럽 추가 (+0원)" - 선택 시 추가 금액 없음
   - 여러 옵션을 동시에 선택 가능

4. **액션 버튼**
   - "담기" 버튼 (밝은 회색 테두리)
   - 클릭 시 선택한 메뉴와 옵션이 장바구니에 추가됨

**레이아웃:**
- 메뉴 카드들은 가로로 배치 (최소 3개 이상 표시 가능)
- 각 카드는 동일한 구조와 스타일 유지
- 카드 내부 요소는 세로로 배치

**스타일:**
- 각 카드는 사각형 박스 형태로 명확하게 구분
- 일관된 간격과 패딩 유지

#### 4.1.4 장바구니 섹션

**위치:** 화면 하단 고정

**구성 요소:**

1. **섹션 제목**
   - "장바구니" 텍스트 (좌측 상단에 표시)

2. **장바구니 아이템 목록**
   - 각 아이템 표시 형식: "메뉴명 (옵션명) X 수량"
   - 예시:
     - "아메리카노(ICE) (샷 추가) X 1"
     - "아메리카노(HOT) X 2"
   - 각 아이템별 가격 표시 (예: "4,500원", "8,000원")
   - 옵션이 없는 경우 "메뉴명 X 수량" 형식으로 표시

3. **총 금액**
   - "총 금액 XX,XXX원" 형식으로 표시
   - 굵은 글씨로 강조
   - 예시: "총 금액 12,500원"

4. **주문하기 버튼**
   - 장바구니 하단에 위치
   - 밝은 회색 테두리 버튼
   - 클릭 시 주문 처리

**스타일:**
- 밝은 회색 테두리로 섹션 구분
- 사각형 박스 형태로 전체 영역 구분
- 장바구니가 비어있을 때의 처리 필요

**레이아웃:**
- 장바구니 아이템 목록은 세로로 배치
- 각 아이템과 가격은 명확하게 구분되어 표시

#### 4.1.5 기능 요구사항

**메뉴 선택 및 옵션:**
1. 사용자는 메뉴 카드에서 원하는 메뉴를 선택
2. 옵션(샷 추가, 시럽 추가 등)을 체크박스로 선택 가능
3. 옵션 선택 시 해당 옵션의 추가 금액이 반영되어야 함
4. 옵션 선택 해제 시 추가 금액이 제외되어야 함

**장바구니 관리:**
1. "담기" 버튼 클릭 시 선택한 메뉴와 옵션이 장바구니에 추가됨
2. 동일한 메뉴와 옵션 조합이 추가되면 수량이 증가
3. 장바구니에 담긴 아이템의 총 금액이 실시간으로 계산되어 표시됨
4. 각 아이템의 가격은 (기본 가격 + 옵션 추가 금액) × 수량으로 계산
5. 장바구니 아이템 삭제 기능 (선택사항)

**주문 처리:**
1. "주문하기" 버튼 클릭 시 장바구니의 모든 아이템이 주문으로 전송됨
2. 주문 완료 후 장바구니 초기화 또는 주문 완료 메시지 표시
3. 주문 데이터는 백엔드 API를 통해 전송

**가격 계산:**
1. 기본 가격: 메뉴 카드에 표시된 가격
2. 옵션 추가 금액: 선택한 옵션들의 추가 금액 합계
3. 아이템 총 가격: (기본 가격 + 옵션 추가 금액) × 수량
4. 장바구니 총 금액: 모든 아이템의 총 가격 합계

#### 4.1.6 UI/UX 가이드라인

**색상:**
- 브랜드 색상: 사각형 박스 형태로 브랜드명 표시
- 기본 버튼: 밝은 회색 테두리
- 활성 상태: 어두운 배경 또는 다른 색상으로 구분

**타이포그래피:**
- 가격은 명확하게 표시
- 총 금액은 굵은 글씨로 강조
- 메뉴명은 가독성 있게 표시

**인터랙션:**
- 버튼 클릭 시 시각적 피드백 제공
- 옵션 선택 시 즉시 반영 (가격 변경은 장바구니에 담을 때 반영)
- 장바구니 추가 시 사용자에게 피드백 제공 (예: 토스트 메시지 또는 장바구니 업데이트)
- "담기" 버튼 클릭 후 해당 메뉴 카드의 옵션 선택은 초기화될 수 있음 (선택사항)

**레이아웃:**
- 각 섹션은 명확하게 구분되어 표시
- 정보의 위계 구조를 명확하게 표현
- 일관된 간격과 정렬 유지

**반응형:**
- 다양한 화면 크기에 대응 가능한 레이아웃
- 모바일 환경에서도 사용 가능하도록 고려
- 메뉴 카드는 화면 크기에 따라 그리드 레이아웃으로 자동 조정

**데이터 표시:**
- 가격은 천 단위 구분 기호(쉼표)를 사용하여 표시 (예: "4,000원")
- 수량은 명확하게 표시
- 옵션이 선택된 경우 장바구니에 "(옵션명)" 형식으로 표시

#### 4.1.7 상세 명세

**메뉴 카드 예시:**
- 아메리카노(ICE): 기본 가격 4,000원
- 아메리카노(HOT): 기본 가격 4,000원
- 카페라떼: 기본 가격 5,000원

**옵션 예시:**
- 샷 추가: +500원
- 시럽 추가: +0원

**장바구니 아이템 표시 예시:**
- "아메리카노(ICE) (샷 추가) X 1" → 4,500원 (4,000 + 500)
- "아메리카노(HOT) X 2" → 8,000원 (4,000 × 2)
- 총 금액: 12,500원

### 4.2 관리자 화면

#### 4.2.1 레이아웃 구조
화면은 상단 헤더와 세 개의 주요 콘텐츠 섹션으로 구성됩니다.

**전체 레이아웃:**
- 헤더: 화면 상단 고정
- 관리자 대시보드 요약: 상단 콘텐츠 영역
- 재고 현황: 중앙 콘텐츠 영역
- 주문 현황: 하단 콘텐츠 영역

#### 4.2.2 헤더 섹션

**구성 요소:**
- 좌측: 브랜드명 "COZY" (사각형 박스 형태로 표시)
- 우측: 네비게이션 버튼
  - "주문하기" 버튼 (비활성 상태: 밝은 회색 테두리)
  - "관리자" 버튼 (활성 상태: 어두운 테두리 또는 강조 표시)

**스타일:**
- 브랜드명은 사각형 박스 형태로 표시
- 네비게이션 버튼은 밝은 회색 테두리
- 활성 탭("관리자")은 시각적으로 구분 가능하도록 처리

**기능:**
- "주문하기" 버튼 클릭 시 주문하기 화면으로 이동

#### 4.2.3 관리자 대시보드 섹션

**섹션 제목:** "관리자 대시보드"

**표시 정보:**
다음 네 가지 주문 통계를 대시보드 형태로 표시:

1. **총 주문**
   - 전체 주문 건수 표시
   - 예시: "총 주문 1"

2. **주문 접수**
   - 접수된 주문 건수 표시
   - 예시: "주문 접수 1"

3. **제조 중**
   - 현재 제조 중인 주문 건수 표시
   - 예시: "제조 중 0"

4. **제조 완료**
   - 제조가 완료된 주문 건수 표시
   - 예시: "제조 완료 0"

**레이아웃:**
- 큰 사각형 박스 형태로 표시
- 통계 정보는 가로로 배치하거나 그리드 형태로 구성
- 각 통계 항목은 명확하게 구분되어 표시

**기능:**
- 실시간으로 주문 상태 통계 업데이트
- 각 통계는 현재 주문 상태를 반영하여 계산됨
- 주문 현황 섹션의 상태 변경이 대시보드에 즉시 반영됨

**스타일:**
- 밝은 회색 테두리로 섹션 구분
- 사각형 박스 형태로 전체 영역 구분
- 통계 숫자는 가독성 있게 표시

#### 4.2.4 재고 현황 섹션

**섹션 제목:** "재고 현황"

**구성 요소:**
각 메뉴 아이템별로 재고 정보를 카드 형태로 표시:

**재고 카드 구조:**
- 메뉴명 표시 (예: "아메리카노 (ICE)", "아메리카노 (HOT)", "카페라떼")
- 현재 재고 수량 표시 (예: "10개")
- 재고 조정 버튼:
  - "+" 버튼: 재고 증가 (좌측에 배치)
  - "-" 버튼: 재고 감소 (우측에 배치)

**레이아웃:**
- 큰 사각형 박스 형태로 섹션 구분
- 각 메뉴 아이템은 동일한 크기의 작은 사각형 카드로 표시
- 카드들은 가로로 배치 (3개 이상일 경우 그리드 레이아웃)
- 메뉴명, 수량, 버튼은 카드 내부에 세로로 배치

**기능 요구사항:**
1. "+" 버튼 클릭 시 해당 메뉴의 재고 수량이 1 증가
2. "-" 버튼 클릭 시 해당 메뉴의 재고 수량이 1 감소
3. 재고 수량은 0 이상으로 유지 (음수 불가)
4. 재고 변경 시 즉시 데이터베이스에 반영
5. 재고 변경 후 화면에 즉시 반영
6. 재고가 0인 메뉴는 주문 화면에서 주문 불가 처리 (선택사항)

**스타일:**
- 밝은 회색 테두리로 섹션 구분
- 각 카드는 사각형 박스 형태로 명확하게 구분
- 버튼은 작은 사각형 형태로 직관적으로 배치
- 일관된 간격과 정렬 유지

**표시 형식:**
- 각 카드에 메뉴명과 현재 재고 수량을 명확하게 표시
- 수량은 "XX개" 형식으로 표시

#### 4.2.5 주문 현황 섹션

**섹션 제목:** "주문 현황"

**위치:** 화면 하단

**구성 요소:**
주문 목록을 표시하는 큰 사각형 박스 형태

**주문 항목 구조:**
각 주문 항목은 다음 정보를 포함:

1. **주문 시간**
   - 주문 접수 시간 표시
   - 형식: "월 일 시:분" (예: "7월 31일 13:00")

2. **주문 내용**
   - 주문한 메뉴와 수량 표시
   - 형식: "메뉴명 x 수량" (예: "아메리카노(ICE) x 1")
   - 여러 메뉴가 포함된 경우 모두 표시

3. **주문 금액**
   - 해당 주문의 총 금액 표시
   - 형식: "X,XXX원" (예: "4,000원")

4. **액션 버튼**
   - 주문 상태에 따른 액션 버튼
   - 예시: "주문 접수" 버튼 (새로운 주문의 경우)
   - 버튼 클릭 시 주문 상태 변경
   - 우측에 배치

**레이아웃:**
- 주문 목록은 세로로 스크롤 가능한 형태
- 각 주문 항목은 명확하게 구분되어 표시
- 주문이 없을 경우 빈 상태 메시지 표시
- 주문 정보는 좌측에, 액션 버튼은 우측에 배치

**스타일:**
- 밝은 회색 테두리로 섹션 구분
- 사각형 박스 형태로 전체 영역 구분
- 각 주문 항목은 명확하게 구분되어 표시

#### 4.2.6 기능 요구사항

**주문 상태 관리:**
1. "주문 접수" 버튼 클릭 시:
   - 주문 상태가 "주문 접수"로 변경됨
   - 대시보드의 "주문 접수" 통계 업데이트
   - 버튼이 "제조 중" 또는 다음 상태로 변경될 수 있음

2. 주문 상태별 표시:
   - 주문 접수: "주문 접수" 버튼 표시 (또는 "제조 중" 버튼으로 변경)
   - 제조 중: "제조 완료" 버튼 표시
   - 제조 완료: 완료 상태 표시 또는 버튼 제거

3. 주문 목록 정렬:
   - 최신 주문이 상단에 표시
   - 주문 시간 기준으로 정렬

4. 실시간 업데이트:
   - 새로운 주문이 들어오면 목록에 자동 추가
   - 주문 상태 변경 시 즉시 화면 반영
   - 대시보드 통계가 실시간으로 업데이트됨

**통합 기능:**

1. **대시보드 통계 연동**
   - 주문 현황의 변화가 대시보드 통계에 실시간 반영
   - 각 상태별 주문 건수가 정확하게 계산되어 표시

2. **재고 관리**
   - 재고가 0인 메뉴는 주문 화면에서 주문 불가 처리 (선택사항)
   - 재고 변경 시 관련 주문 가능 여부 업데이트

3. **주문 처리 흐름**
   - 주문 접수 → 제조 중 → 제조 완료 순서로 상태 변경
   - 각 단계에서 적절한 액션 버튼 제공

4. **데이터 동기화**
   - 모든 변경사항은 즉시 데이터베이스에 반영
   - 여러 관리자가 동시에 접근할 경우 데이터 일관성 유지

#### 4.2.7 UI/UX 가이드라인

**색상:**
- 브랜드 색상: 사각형 박스 형태로 브랜드명 표시
- 기본 버튼: 밝은 회색 테두리
- 활성 상태: 어두운 테두리 또는 다른 색상으로 강조
- 섹션 구분: 사각형 박스 형태로 명확하게 구분

**타이포그래피:**
- 섹션 제목은 명확하게 표시
- 통계 숫자는 가독성 있게 표시
- 주문 시간과 금액은 명확하게 구분
- 메뉴명과 수량은 가독성 있게 표시

**인터랙션:**
- 버튼 클릭 시 시각적 피드백 제공
- 재고 변경 시 즉시 화면에 반영
- 주문 상태 변경 시 명확한 피드백 제공
- 로딩 상태 표시 (선택사항)

**레이아웃:**
- 각 섹션은 명확하게 구분되어 표시
- 정보의 위계 구조를 명확하게 표현
- 스크롤 가능한 영역은 명확하게 표시
- 일관된 간격과 정렬 유지

**반응형:**
- 다양한 화면 크기에 대응 가능한 레이아웃
- 태블릿 및 데스크톱 환경 최적화
- 그리드 레이아웃은 화면 크기에 따라 자동 조정
- 재고 카드와 통계 항목은 화면 크기에 따라 자동 조정

**데이터 표시:**
- 가격은 천 단위 구분 기호(쉼표)를 사용하여 표시 (예: "4,000원")
- 재고 수량은 "XX개" 형식으로 표시
- 주문 시간은 "월 일 시:분" 형식으로 표시
- 주문 내용은 "메뉴명 x 수량" 형식으로 표시

#### 4.2.8 상세 명세

**재고 카드 예시:**
- 아메리카노 (ICE): 재고 10개
- 아메리카노 (HOT): 재고 10개
- 카페라떼: 재고 10개

**주문 항목 표시 예시:**
- 주문 시간: "7월 31일 13:00"
- 주문 내용: "아메리카노(ICE) x 1"
- 주문 금액: "4,000원"
- 액션 버튼: "주문 접수"

**주문 상태 흐름:**
1. 새로운 주문: "주문 접수" 버튼 표시
2. 주문 접수 클릭: 상태가 "주문 접수"로 변경, "제조 중" 버튼으로 변경 (또는 다음 단계 버튼)
3. 제조 중 클릭: 상태가 "제조 중"으로 변경, "제조 완료" 버튼 표시
4. 제조 완료 클릭: 상태가 "제조 완료"로 변경, 버튼 제거 또는 완료 표시

## 5. 백엔드 개발 요구사항

### 5.1 데이터 모델

백엔드 개발을 위해 다음 데이터 모델을 설계합니다.

#### 5.1.1 Menu (메뉴)

메뉴 정보를 저장하는 테이블입니다.

**필드:**
- `id` (INTEGER, PRIMARY KEY): 메뉴 고유 ID
- `name` (VARCHAR): 메뉴 이름 (예: "아메리카노(ICE)", "카페라떼")
- `description` (TEXT): 메뉴 설명 (예: "시원한 아메리카노", "부드러운 라떼")
- `price` (INTEGER): 메뉴 가격 (단위: 원)
- `image` (VARCHAR): 메뉴 이미지 URL
- `stock` (INTEGER): 재고 수량 (기본값: 10)
- `created_at` (TIMESTAMP): 생성 일시
- `updated_at` (TIMESTAMP): 수정 일시

**예시 데이터:**
```json
{
  "id": 1,
  "name": "아메리카노(ICE)",
  "description": "시원한 아메리카노",
  "price": 4000,
  "image": "https://images.unsplash.com/photo-1544787219-7f47ccb76574?w=400&h=300&fit=crop",
  "stock": 10,
  "created_at": "2024-01-01T00:00:00Z",
  "updated_at": "2024-01-01T00:00:00Z"
}
```

#### 5.1.2 Options (옵션)

메뉴 옵션 정보를 저장하는 테이블입니다.

**필드:**
- `id` (INTEGER, PRIMARY KEY): 옵션 고유 ID
- `name` (VARCHAR): 옵션 이름 (예: "샷 추가", "시럽 추가")
- `price` (INTEGER): 옵션 추가 가격 (단위: 원, 기본값: 0)
- `menu_id` (INTEGER, FOREIGN KEY): 연결된 메뉴 ID (NULL 허용 - 모든 메뉴에 적용 가능)
- `created_at` (TIMESTAMP): 생성 일시
- `updated_at` (TIMESTAMP): 수정 일시

**예시 데이터:**
```json
{
  "id": 1,
  "name": "샷 추가",
  "price": 500,
  "menu_id": null,
  "created_at": "2024-01-01T00:00:00Z",
  "updated_at": "2024-01-01T00:00:00Z"
}
```

**참고:**
- `menu_id`가 NULL인 경우 모든 메뉴에 적용 가능한 옵션
- `menu_id`가 특정 값을 가지는 경우 해당 메뉴에만 적용되는 옵션

#### 5.1.3 Orders (주문)

주문 정보를 저장하는 테이블입니다.

**필드:**
- `id` (INTEGER, PRIMARY KEY): 주문 고유 ID
- `order_number` (VARCHAR, UNIQUE): 주문 번호 (예: "ORD-001", "ORD-002")
- `order_date` (TIMESTAMP): 주문 일시
- `status` (VARCHAR): 주문 상태
  - `pending`: 주문 접수 대기
  - `received`: 주문 접수
  - `preparing`: 제조 중
  - `completed`: 제조 완료
- `total_amount` (INTEGER): 주문 총 금액 (단위: 원)
- `created_at` (TIMESTAMP): 생성 일시
- `updated_at` (TIMESTAMP): 수정 일시

**예시 데이터:**
```json
{
  "id": 1,
  "order_number": "ORD-001",
  "order_date": "2024-07-31T13:00:00Z",
  "status": "pending",
  "total_amount": 4500,
  "created_at": "2024-07-31T13:00:00Z",
  "updated_at": "2024-07-31T13:00:00Z"
}
```

#### 5.1.4 OrderItems (주문 상세)

주문에 포함된 메뉴와 옵션 정보를 저장하는 테이블입니다.

**필드:**
- `id` (INTEGER, PRIMARY KEY): 주문 상세 고유 ID
- `order_id` (INTEGER, FOREIGN KEY): 주문 ID
- `menu_id` (INTEGER, FOREIGN KEY): 메뉴 ID
- `quantity` (INTEGER): 수량
- `unit_price` (INTEGER): 단가 (메뉴 가격 + 옵션 가격 합계)
- `options` (JSON 또는 TEXT): 선택한 옵션 정보 (옵션 ID 배열 또는 JSON 문자열)
- `created_at` (TIMESTAMP): 생성 일시

**예시 데이터:**
```json
{
  "id": 1,
  "order_id": 1,
  "menu_id": 1,
  "quantity": 1,
  "unit_price": 4500,
  "options": "[1]",
  "created_at": "2024-07-31T13:00:00Z"
}
```

**참고:**
- `options` 필드는 JSON 배열 형태로 옵션 ID들을 저장 (예: "[1, 2]" 또는 '[{"id": 1, "name": "샷 추가", "price": 500}]')
- `unit_price`는 메뉴 가격과 선택한 옵션들의 가격 합계

### 5.2 데이터 스키마를 위한 사용자 흐름

#### 5.2.1 메뉴 조회 흐름

1. **주문하기 화면 진입**
   - 프런트엔드에서 `GET /api/menus` API 호출
   - 백엔드에서 `Menus` 테이블에서 모든 메뉴 정보 조회
   - 메뉴 목록 반환 (재고 수량 제외)
   - 프런트엔드에서 메뉴 카드에 메뉴 정보 표시

2. **관리자 화면 진입**
   - 프런트엔드에서 `GET /api/menus?include_stock=true` API 호출
   - 백엔드에서 `Menus` 테이블에서 모든 메뉴 정보 조회 (재고 수량 포함)
   - 메뉴 목록과 재고 정보 반환
   - 관리자 화면의 "재고 현황" 섹션에 재고 수량 표시

#### 5.2.2 옵션 조회 흐름

1. **메뉴 선택 시 옵션 표시**
   - 프런트엔드에서 `GET /api/options?menu_id={menu_id}` API 호출
   - 백엔드에서 `Options` 테이블에서 해당 메뉴에 적용 가능한 옵션 조회
     - `menu_id`가 NULL인 옵션 (모든 메뉴 공통)
     - `menu_id`가 특정 메뉴 ID인 옵션
   - 옵션 목록 반환
   - 프런트엔드에서 메뉴 카드에 옵션 체크박스 표시

#### 5.2.3 주문 처리 흐름

1. **장바구니에서 주문하기 버튼 클릭**
   - 프런트엔드에서 장바구니 정보 수집
     - 선택한 메뉴 ID, 수량, 선택한 옵션 ID 배열
     - 각 아이템별 단가 계산 (메뉴 가격 + 옵션 가격 합계)
     - 주문 총 금액 계산

2. **주문 정보 저장**
   - 프런트엔드에서 `POST /api/orders` API 호출
   - 요청 본문:
     ```json
     {
       "items": [
         {
           "menu_id": 1,
           "quantity": 1,
           "options": [1],
           "unit_price": 4500
         }
       ],
       "total_amount": 4500
     }
     ```
   - 백엔드 처리:
     a. 주문 번호 생성 (예: "ORD-001", "ORD-002")
     b. `Orders` 테이블에 주문 정보 저장
       - `order_date`: 현재 일시
       - `status`: "pending" (주문 접수 대기)
       - `total_amount`: 주문 총 금액
     c. `OrderItems` 테이블에 주문 상세 정보 저장
       - 각 아이템별로 레코드 생성
     d. `Menus` 테이블의 재고 수량 업데이트
       - 주문한 메뉴의 재고에서 주문 수량만큼 차감
       - 재고가 부족한 경우 에러 반환

3. **주문 완료 응답**
   - 백엔드에서 주문 정보 반환
   - 프런트엔드에서 장바구니 초기화 및 주문 완료 메시지 표시

#### 5.2.4 주문 현황 조회 흐름

1. **관리자 화면 진입**
   - 프런트엔드에서 `GET /api/orders` API 호출
   - 백엔드에서 `Orders` 테이블과 `OrderItems` 테이블을 조인하여 주문 정보 조회
   - 주문 목록 반환 (주문 시간 기준 내림차순 정렬)
   - 관리자 화면의 "주문 현황" 섹션에 주문 목록 표시

2. **주문 상태 변경**
   - 관리자가 "주문 접수", "제조 시작", "제조 완료" 버튼 클릭
   - 프런트엔드에서 `PATCH /api/orders/{order_id}/status` API 호출
   - 요청 본문:
     ```json
     {
       "status": "received"  // 또는 "preparing", "completed"
     }
     ```
   - 백엔드에서 `Orders` 테이블의 `status` 필드 업데이트
   - 업데이트된 주문 정보 반환
   - 프런트엔드에서 주문 현황 화면 업데이트

#### 5.2.5 재고 관리 흐름

1. **재고 조회**
   - 관리자 화면에서 `GET /api/menus?include_stock=true` API 호출
   - 백엔드에서 `Menus` 테이블에서 메뉴 정보와 재고 수량 조회
   - 재고 정보 반환

2. **재고 수정**
   - 관리자가 재고 증가/감소 버튼 클릭
   - 프런트엔드에서 `PATCH /api/menus/{menu_id}/stock` API 호출
   - 요청 본문:
     ```json
     {
       "operation": "increase",  // 또는 "decrease"
       "amount": 1
     }
     ```
   - 백엔드에서 `Menus` 테이블의 `stock` 필드 업데이트
     - `increase`: 현재 재고 + amount
     - `decrease`: 현재 재고 - amount (단, 0 미만으로 내려가지 않도록 제한)
   - 업데이트된 재고 정보 반환
   - 프런트엔드에서 재고 현황 화면 업데이트

### 5.3 API 설계

#### 5.3.1 메뉴 관련 API

##### GET /api/menus
메뉴 목록을 조회합니다.

**Query Parameters:**
- `include_stock` (boolean, optional): 재고 수량 포함 여부 (기본값: false)
  - `true`: 재고 수량 포함
  - `false`: 재고 수량 제외

**Response 200 OK:**
```json
{
  "menus": [
    {
      "id": 1,
      "name": "아메리카노(ICE)",
      "description": "시원한 아메리카노",
      "price": 4000,
      "image": "https://images.unsplash.com/photo-1544787219-7f47ccb76574?w=400&h=300&fit=crop",
      "stock": 10  // include_stock=true인 경우에만 포함
    },
    {
      "id": 2,
      "name": "아메리카노(HOT)",
      "description": "따뜻한 아메리카노",
      "price": 4000,
      "image": "https://images.unsplash.com/photo-1495474472287-4d71bcdd2085?w=400&h=300&fit=crop",
      "stock": 10  // include_stock=true인 경우에만 포함
    }
  ]
}
```

##### GET /api/menus/:id
특정 메뉴 정보를 조회합니다.

**Path Parameters:**
- `id` (integer): 메뉴 ID

**Response 200 OK:**
```json
{
  "id": 1,
  "name": "아메리카노(ICE)",
  "description": "시원한 아메리카노",
  "price": 4000,
  "image": "https://images.unsplash.com/photo-1544787219-7f47ccb76574?w=400&h=300&fit=crop",
  "stock": 10
}
```

##### PATCH /api/menus/:id/stock
메뉴 재고를 수정합니다.

**Path Parameters:**
- `id` (integer): 메뉴 ID

**Request Body:**
```json
{
  "operation": "increase",  // "increase" 또는 "decrease"
  "amount": 1  // 증감 수량
}
```

**Response 200 OK:**
```json
{
  "id": 1,
  "name": "아메리카노(ICE)",
  "stock": 11,
  "updated_at": "2024-07-31T13:05:00Z"
}
```

**Error Response 400 Bad Request:**
```json
{
  "error": "재고는 0보다 작을 수 없습니다."
}
```

#### 5.3.2 옵션 관련 API

##### GET /api/options
옵션 목록을 조회합니다.

**Query Parameters:**
- `menu_id` (integer, optional): 메뉴 ID
  - 지정된 경우: 해당 메뉴에 적용 가능한 옵션만 조회
  - 미지정된 경우: 모든 옵션 조회

**Response 200 OK:**
```json
{
  "options": [
    {
      "id": 1,
      "name": "샷 추가",
      "price": 500,
      "menu_id": null
    },
    {
      "id": 2,
      "name": "시럽 추가",
      "price": 0,
      "menu_id": null
    }
  ]
}
```

#### 5.3.3 주문 관련 API

##### GET /api/orders
주문 목록을 조회합니다.

**Query Parameters:**
- `status` (string, optional): 주문 상태 필터 (pending, received, preparing, completed)
- `limit` (integer, optional): 조회할 최대 개수 (기본값: 100)
- `offset` (integer, optional): 건너뛸 개수 (기본값: 0)

**Response 200 OK:**
```json
{
  "orders": [
    {
      "id": 1,
      "order_number": "ORD-001",
      "order_date": "2024-07-31T13:00:00Z",
      "status": "pending",
      "total_amount": 4500,
      "items": [
        {
          "id": 1,
          "menu_id": 1,
          "menu_name": "아메리카노(ICE)",
          "quantity": 1,
          "unit_price": 4500,
          "options": [
            {
              "id": 1,
              "name": "샷 추가",
              "price": 500
            }
          ]
        }
      ]
    }
  ],
  "total": 1
}
```

##### GET /api/orders/:id
특정 주문 정보를 조회합니다.

**Path Parameters:**
- `id` (integer): 주문 ID

**Response 200 OK:**
```json
{
  "id": 1,
  "order_number": "ORD-001",
  "order_date": "2024-07-31T13:00:00Z",
  "status": "pending",
  "total_amount": 4500,
  "items": [
    {
      "id": 1,
      "menu_id": 1,
      "menu_name": "아메리카노(ICE)",
      "quantity": 1,
      "unit_price": 4500,
      "options": [
        {
          "id": 1,
          "name": "샷 추가",
          "price": 500
        }
      ]
    }
  ]
}
```

##### POST /api/orders
새 주문을 생성합니다.

**Request Body:**
```json
{
  "items": [
    {
      "menu_id": 1,
      "quantity": 1,
      "options": [1],  // 옵션 ID 배열
      "unit_price": 4500
    },
    {
      "menu_id": 2,
      "quantity": 2,
      "options": [],
      "unit_price": 4000
    }
  ],
  "total_amount": 12500
}
```

**Response 201 Created:**
```json
{
  "id": 1,
  "order_number": "ORD-001",
  "order_date": "2024-07-31T13:00:00Z",
  "status": "pending",
  "total_amount": 12500,
  "items": [
    {
      "id": 1,
      "menu_id": 1,
      "menu_name": "아메리카노(ICE)",
      "quantity": 1,
      "unit_price": 4500,
      "options": [
        {
          "id": 1,
          "name": "샷 추가",
          "price": 500
        }
      ]
    },
    {
      "id": 2,
      "menu_id": 2,
      "menu_name": "아메리카노(HOT)",
      "quantity": 2,
      "unit_price": 4000,
      "options": []
    }
  ]
}
```

**Error Response 400 Bad Request:**
```json
{
  "error": "재고가 부족합니다.",
  "details": {
    "menu_id": 1,
    "available_stock": 5,
    "requested_quantity": 10
  }
}
```

**처리 로직:**
1. 주문 번호 생성 (가장 최근 주문 번호 + 1 또는 "ORD-001"부터 시작)
2. 주문 정보를 `Orders` 테이블에 저장
3. 각 주문 아이템에 대해:
   a. 해당 메뉴의 재고 확인
   b. 재고가 부족한 경우 에러 반환
   c. 재고가 충분한 경우 `OrderItems` 테이블에 저장
   d. `Menus` 테이블의 재고 수량 차감
4. 저장된 주문 정보 반환

##### PATCH /api/orders/:id/status
주문 상태를 변경합니다.

**Path Parameters:**
- `id` (integer): 주문 ID

**Request Body:**
```json
{
  "status": "received"  // "pending", "received", "preparing", "completed" 중 하나
}
```

**Response 200 OK:**
```json
{
  "id": 1,
  "order_number": "ORD-001",
  "status": "received",
  "updated_at": "2024-07-31T13:05:00Z"
}
```

**Error Response 400 Bad Request:**
```json
{
  "error": "유효하지 않은 주문 상태입니다."
}
```

#### 5.3.4 통계 관련 API

##### GET /api/orders/stats
주문 통계를 조회합니다.

**Response 200 OK:**
```json
{
  "total": 10,
  "received": 3,
  "preparing": 2,
  "completed": 5
}
```

**통계 계산:**
- `total`: 전체 주문 건수
- `received`: 상태가 "received"인 주문 건수
- `preparing`: 상태가 "preparing"인 주문 건수
- `completed`: 상태가 "completed"인 주문 건수

### 5.4 에러 처리

모든 API는 일관된 에러 응답 형식을 사용합니다.

**Error Response Format:**
```json
{
  "error": "에러 메시지",
  "details": {}  // 선택적 상세 정보
}
```

**HTTP Status Codes:**
- `200 OK`: 성공
- `201 Created`: 리소스 생성 성공
- `400 Bad Request`: 잘못된 요청 (재고 부족, 유효하지 않은 데이터 등)
- `404 Not Found`: 리소스를 찾을 수 없음
- `500 Internal Server Error`: 서버 내부 오류

### 5.5 데이터베이스 설계 고려사항

1. **트랜잭션 처리**
   - 주문 생성 시 주문 정보 저장과 재고 차감을 하나의 트랜잭션으로 처리
   - 재고 부족 시 롤백

2. **인덱스**
   - `Orders.order_date`: 주문 목록 조회 시 정렬 성능 향상
   - `Orders.status`: 상태별 필터링 성능 향상
   - `OrderItems.order_id`: 주문 상세 조회 시 조인 성능 향상
   - `OrderItems.menu_id`: 메뉴별 주문 통계 조회 시 성능 향상

3. **제약 조건**
   - `Orders.order_number`: UNIQUE 제약
   - `Menus.stock`: 0 이상의 값만 허용
   - `Orders.status`: 지정된 상태 값만 허용 (pending, received, preparing, completed)

4. **데이터 무결성**
   - 외래 키 제약 조건으로 참조 무결성 보장
   - 주문 삭제 시 관련 주문 상세 정보도 함께 삭제 (CASCADE) 또는 보존 정책 결정